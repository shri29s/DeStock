(()=>{var e={};e.id=208,e.ids=[208],e.modules={2339:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,pages:()=>l,routeModule:()=>u,tree:()=>d});var r=s(24332),n=s(48819),a=s(67851),i=s.n(a),o=s(97540),c={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>o[e]);s.d(t,c);let d={children:["",{children:["company",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,72077)),"/home/shri/web3Hackathon/DeStock/apps/web/app/company/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,34356)),"/home/shri/web3Hackathon/DeStock/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,19033,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,39956,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,92341,23)),"next/dist/client/components/unauthorized-error"]}]}.children,l=["/home/shri/web3Hackathon/DeStock/apps/web/app/company/[id]/page.tsx"],p={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/company/[id]/page",pathname:"/company/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},49934:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(13486),n=s(2984),a=s(77295),i=s(38049),o=s(24665),c=s(4574),d=s(86535),l=s(77943),p=s(34562),u=s(60159),m=s(67201),x=s(85626),h=s(85519);function g({companyId:e}){let[t,s]=(0,u.useState)([]),[n,a]=(0,u.useState)(!0);return n?(0,r.jsx)("div",{children:"Loading trade history..."}):(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Trade History"}),(0,r.jsx)("ul",{className:"space-y-2",children:t.map((e,t)=>(0,r.jsxs)("li",{className:`p-2 rounded-md ${"buy"===e.type?"bg-green-100":"bg-red-100"}`,children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:e.type.toUpperCase()}),(0,r.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("span",{children:[e.amount," shares"]}),(0,r.jsxs)("span",{children:[(0,p.J)(BigInt(e.price),18)," DSTK"]})]}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]},t))})]})}function b({companyId:e}){let[t,s]=(0,u.useState)([]),[n,a]=(0,u.useState)(!0);return n?(0,r.jsx)("div",{children:"Loading shareholders..."}):(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Shareholders"}),(0,r.jsx)("ul",{className:"space-y-2",children:t.map((e,t)=>(0,r.jsx)("li",{className:"p-2 rounded-md bg-gray-100",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:e.address}),(0,r.jsxs)("span",{children:[e.balance," shares"]})]})},t))})]})}let f=m.Ik({amount:m.Yj().min(1,"Amount is required")});function y(){let{id:e}=(0,n.useParams)(),t=parseInt(e),{isConnected:s,address:m,chainId:y}=(0,i.F)(),{getCompany:j,getSharePrice:v,buyShares:w,sellShares:N}=(0,a.P)(),{balance:S,approve:C,allowance:k,isApproving:q}=function(){let{address:e,chainId:t}=(0,i.F)(),s=(0,d.RZ)("DSTK_TOKEN",t??31337),r=(0,d.RZ)("DESTOCK",t??31337),n=e??"0x0000000000000000000000000000000000000000",{data:a,refetch:p}=(0,o.Q)({abi:d.MO,address:s,functionName:"balanceOf",args:[n]}),{data:u,refetch:m}=(0,o.Q)({abi:d.MO,address:s,functionName:"allowance",args:[n,r]}),{writeContractAsync:x,isPending:h}=(0,c.x)(),g=async e=>{await x({abi:d.MO,address:s,functionName:"approve",args:[r,(0,l.g)(e)]}),m()},{writeContractAsync:b}=(0,c.x)(),{writeContractAsync:f}=(0,c.x)(),{writeContractAsync:y}=(0,c.x)();return{balance:a,allowance:u,approve:g,isApproving:h,mint:b,transferFromContract:f,batchAirDrop:y,refetchBalance:p,refetchAllowance:m}}(),B=(0,d.RZ)("DESTOCK",y??31337),{data:P}=j(t),{data:I}=v(t),A=function(e){if(Array.isArray(e)&&e.length>=5&&"bigint"==typeof e[0]&&"string"==typeof e[1]&&"string"==typeof e[2]&&"bigint"==typeof e[3]&&"bigint"==typeof e[4])return{id:e[0],name:e[1],owner:e[2],initialPrice:e[3],totalSupply:e[4]}}(P),[_,D]=(0,u.useState)(!0),{register:T,handleSubmit:O,watch:E,formState:{errors:K}}=(0,x.mN)({resolver:(0,h.u)(f)}),$=E("amount");I&&$&&(BigInt(I)*BigInt($)).toString();let R=async()=>{if(I&&$){let e=BigInt(I)*BigInt($);C((0,p.J)(e,18))}},H=async e=>{await w({abi:d.$B,address:B,functionName:"buyShares",args:[BigInt(t),BigInt(e.amount)]})},M=async e=>{await N({abi:d.$B,address:B,functionName:"sellShares",args:[BigInt(t),BigInt(e.amount)]})};return A?(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-4",children:A.name}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Company Details"}),(0,r.jsxs)("p",{children:["Owner: ",A.owner]}),(0,r.jsxs)("p",{children:["Total Supply: ",A.totalSupply.toString()]}),(0,r.jsxs)("p",{children:["Share Price: ",I?(0,p.J)(I,18):"N/A"," DSTK"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Trade"}),(0,r.jsxs)("form",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount"}),(0,r.jsx)("input",{...T("amount"),type:"number",id:"amount",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),K.amount&&(0,r.jsx)("p",{className:"text-red-500 text-sm",children:K.amount.message})]}),I&&$&&(0,r.jsxs)("p",{children:["Estimated Cost:"," ",(0,p.J)(BigInt(I)*BigInt($),18)," ","DSTK"]}),(0,r.jsxs)("div",{className:"flex space-x-4",children:[_?(0,r.jsx)("button",{type:"button",onClick:R,disabled:q,className:"w-full destock-button-secondary",children:q?"Approving...":"Approve DSTK"}):(0,r.jsx)("button",{type:"button",onClick:O(H),className:"w-full destock-button-primary",children:"Buy Shares"}),(0,r.jsx)("button",{type:"button",onClick:O(M),className:"w-full destock-button-danger",children:"Sell Shares"})]})]})]})]}),(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(g,{companyId:t})}),(0,r.jsx)("div",{className:"mt-8",children:(0,r.jsx)(b,{companyId:t})})]}):(0,r.jsx)("div",{children:"Loading..."})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72077:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(33952).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/shri/web3Hackathon/DeStock/apps/web/app/company/[id]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/shri/web3Hackathon/DeStock/apps/web/app/company/[id]/page.tsx","default")},73814:(e,t,s)=>{Promise.resolve().then(s.bind(s,72077))},74075:e=>{"use strict";e.exports=require("zlib")},77295:(e,t,s)=>{"use strict";s.d(t,{P:()=>c});var r=s(38049),n=s(24665),a=s(4574),i=s(86535),o=s(77943);function c(){let{chainId:e}=(0,r.F)(),t=(0,i.RZ)("DESTOCK",e??31337),{data:s,refetch:c}=(0,n.Q)({abi:i.$B,address:t,functionName:"nextCompanyId"}),{writeContractAsync:d,isPending:l,error:p}=(0,a.x)(),u=async(e,s,r,n)=>{await d({abi:i.$B,address:t,functionName:"registerCompany",args:[e,BigInt(r),(0,o.g)(s),n]}),c()},{writeContractAsync:m}=(0,a.x)(),{writeContractAsync:x}=(0,a.x)();return{nextCompanyId:Number(s),registerCompany:u,isPending:l,error:p,getCompany:e=>(0,n.Q)({abi:i.$B,address:t,functionName:"companies",args:[BigInt(e)]}),getSharePrice:e=>(0,n.Q)({abi:i.$B,address:t,functionName:"getSharePrice",args:[BigInt(e)]}),getShareBalance:(e,s)=>(0,n.Q)({abi:i.$B,address:t,functionName:"balanceOf",args:[s,BigInt(e)]}),buyShares:m,sellShares:x}}},77598:e=>{"use strict";e.exports=require("node:crypto")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},97374:(e,t,s)=>{Promise.resolve().then(s.bind(s,49934))}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[191,363,397,520],()=>s(2339));module.exports=r})();