(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{15098:(e,s,t)=>{Promise.resolve().then(t.bind(t,38290))},36543:(e,s,t)=>{"use strict";t.d(s,{P:()=>l});var a=t(33055),n=t(54953),r=t(441),i=t(14532),c=t(53995);function l(){let{chainId:e}=(0,a.F)(),s=(0,i.RZ)("DESTOCK",null!=e?e:31337),{data:t,refetch:l}=(0,n.Q)({abi:i.$B,address:s,functionName:"nextCompanyId"}),{writeContractAsync:d,isPending:o,error:u}=(0,r.x)(),m=async(e,t,a,n)=>{await d({abi:i.$B,address:s,functionName:"registerCompany",args:[e,BigInt(a),(0,c.g)(t),n]}),l()},{writeContractAsync:h}=(0,r.x)(),{writeContractAsync:x}=(0,r.x)();return{nextCompanyId:Number(t),registerCompany:m,isPending:o,error:u,getCompany:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"companies",args:[BigInt(e)]}),getSharePrice:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"getSharePrice",args:[BigInt(e)]}),getShareBalance:(e,t)=>(0,n.Q)({abi:i.$B,address:s,functionName:"balanceOf",args:[t,BigInt(e)]}),buyShares:h,sellShares:x}}},38290:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>b});var a=t(54568),n=t(62942),r=t(36543),i=t(33055),c=t(54953),l=t(441),d=t(14532),o=t(53995),u=t(29548),m=t(7620),h=t(68072),x=t(61938),f=t(90060);function g(e){let{companyId:s}=e,[t,n]=(0,m.useState)([]),[r,i]=(0,m.useState)(!0);return((0,m.useEffect)(()=>{!async function(){try{let e=await fetch("/api/trades/".concat(s)),t=await e.json();n(t)}catch(e){console.error("Failed to fetch trade history:",e)}finally{i(!1)}}()},[s]),r)?(0,a.jsx)("div",{children:"Loading trade history..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Trade History"}),(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsxs)("li",{className:"p-2 rounded-md ".concat("buy"===e.type?"bg-green-100":"bg-red-100"),children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.type.toUpperCase()}),(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[e.amount," shares"]}),(0,a.jsxs)("span",{children:[(0,u.J)(BigInt(e.price),18)," DSTK"]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]},s))})]})}function p(e){let{companyId:s}=e,[t,n]=(0,m.useState)([]),[r,i]=(0,m.useState)(!0);return((0,m.useEffect)(()=>{!async function(){try{let e=await fetch("/api/shareholders/".concat(s)),t=await e.json();n(t)}catch(e){console.error("Failed to fetch shareholders:",e)}finally{i(!1)}}()},[s]),r)?(0,a.jsx)("div",{children:"Loading shareholders..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Shareholders"}),(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsx)("li",{className:"p-2 rounded-md bg-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.address}),(0,a.jsxs)("span",{children:[e.balance," shares"]})]})},s))})]})}let y=h.Ik({amount:h.Yj().min(1,"Amount is required")});function b(){let{id:e}=(0,n.useParams)(),s=parseInt(e),{isConnected:t,address:h,chainId:b}=(0,i.F)(),{getCompany:j,getSharePrice:N,buyShares:S,sellShares:w}=(0,r.P)(),{balance:v,approve:B,allowance:I,isApproving:C}=function(){let{address:e,chainId:s}=(0,i.F)(),t=(0,d.RZ)("DSTK_TOKEN",null!=s?s:31337),a=(0,d.RZ)("DESTOCK",null!=s?s:31337),n=null!=e?e:"0x0000000000000000000000000000000000000000",{data:r,refetch:u}=(0,c.Q)({abi:d.MO,address:t,functionName:"balanceOf",args:[n]}),{data:m,refetch:h}=(0,c.Q)({abi:d.MO,address:t,functionName:"allowance",args:[n,a]}),{writeContractAsync:x,isPending:f}=(0,l.x)(),g=async e=>{await x({abi:d.MO,address:t,functionName:"approve",args:[a,(0,o.g)(e)]}),h()},{writeContractAsync:p}=(0,l.x)(),{writeContractAsync:y}=(0,l.x)(),{writeContractAsync:b}=(0,l.x)();return{balance:r,allowance:m,approve:g,isApproving:f,mint:p,transferFromContract:y,batchAirDrop:b,refetchBalance:u,refetchAllowance:h}}(),P=(0,d.RZ)("DESTOCK",null!=b?b:31337),{data:A}=j(s),{data:k}=N(s),O=function(e){if(Array.isArray(e)&&e.length>=5&&"bigint"==typeof e[0]&&"string"==typeof e[1]&&"string"==typeof e[2]&&"bigint"==typeof e[3]&&"bigint"==typeof e[4])return{id:e[0],name:e[1],owner:e[2],initialPrice:e[3],totalSupply:e[4]}}(A),[T,E]=(0,m.useState)(!0),{register:D,handleSubmit:K,watch:R,formState:{errors:$}}=(0,x.mN)({resolver:(0,f.u)(y)}),_=R("amount");k&&_&&(BigInt(k)*BigInt(_)).toString(),(0,m.useEffect)(()=>{t&&h&&I&&k&&_&&E(BigInt(I.toString())<BigInt(k)*BigInt(_))},[t,h,I,k,_]);let F=async()=>{if(k&&_){let e=BigInt(k)*BigInt(_);B((0,u.J)(e,18))}},Q=async e=>{await S({abi:d.$B,address:P,functionName:"buyShares",args:[BigInt(s),BigInt(e.amount)]})},J=async e=>{await w({abi:d.$B,address:P,functionName:"sellShares",args:[BigInt(s),BigInt(e.amount)]})};return O?(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:O.name}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Company Details"}),(0,a.jsxs)("p",{children:["Owner: ",O.owner]}),(0,a.jsxs)("p",{children:["Total Supply: ",O.totalSupply.toString()]}),(0,a.jsxs)("p",{children:["Share Price: ",k?(0,u.J)(k,18):"N/A"," DSTK"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Trade"}),(0,a.jsxs)("form",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount"}),(0,a.jsx)("input",{...D("amount"),type:"number",id:"amount",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),$.amount&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:$.amount.message})]}),k&&_&&(0,a.jsxs)("p",{children:["Estimated Cost:"," ",(0,u.J)(BigInt(k)*BigInt(_),18)," ","DSTK"]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[T?(0,a.jsx)("button",{type:"button",onClick:F,disabled:C,className:"w-full destock-button-secondary",children:C?"Approving...":"Approve DSTK"}):(0,a.jsx)("button",{type:"button",onClick:K(Q),className:"w-full destock-button-primary",children:"Buy Shares"}),(0,a.jsx)("button",{type:"button",onClick:K(J),className:"w-full destock-button-danger",children:"Sell Shares"})]})]})]})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(g,{companyId:s})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(p,{companyId:s})})]}):(0,a.jsx)("div",{children:"Loading..."})}},62942:(e,s,t)=>{"use strict";var a=t(42418);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})}},e=>{var s=s=>e(e.s=s);e.O(0,[55,823,599,532,587,315,358],()=>s(15098)),_N_E=e.O()}]);