(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{7787:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(54568),n=t(62942),r=t(36543),i=t(80660),c=t(33055),l=t(29548),d=t(7620),o=t(68072),u=t(61938),m=t(90060);function h(e){let{companyId:s}=e,[t,n]=(0,d.useState)([]),[r,i]=(0,d.useState)(!0);return((0,d.useEffect)(()=>{!async function(){try{let e=await fetch("/api/trades/".concat(s)),t=await e.json();n(t)}catch(e){console.error("Failed to fetch trade history:",e)}finally{i(!1)}}()},[s]),r)?(0,a.jsx)("div",{children:"Loading trade history..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Trade History"}),(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsxs)("li",{className:"p-2 rounded-md ".concat("buy"===e.type?"bg-green-100":"bg-red-100"),children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.type.toUpperCase()}),(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[e.amount," shares"]}),(0,a.jsxs)("span",{children:[(0,l.J)(BigInt(e.price),18)," DSTK"]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]},s))})]})}function x(e){let{companyId:s}=e,[t,n]=(0,d.useState)([]),[r,i]=(0,d.useState)(!0);return((0,d.useEffect)(()=>{!async function(){try{let e=await fetch("/api/shareholders/".concat(s)),t=await e.json();n(t)}catch(e){console.error("Failed to fetch shareholders:",e)}finally{i(!1)}}()},[s]),r)?(0,a.jsx)("div",{children:"Loading shareholders..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Shareholders"}),(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsx)("li",{className:"p-2 rounded-md bg-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.address}),(0,a.jsxs)("span",{children:[e.balance," shares"]})]})},s))})]})}let f=o.Ik({amount:o.Yj().min(1,"Amount is required")});function g(){let{id:e}=(0,n.useParams)(),s=parseInt(e),{isConnected:t,address:o}=(0,c.F)(),{getCompany:g,getSharePrice:p,getBuyPrice:y,getSellPrice:j,buyShares:b,sellShares:N}=(0,r.P)(),{balance:w,approve:S,allowance:v,isApproving:C}=(0,i.W)(),{data:B}=g(s),{data:I}=p(s),[P,k]=(0,d.useState)(),[A,E]=(0,d.useState)(),[T,D]=(0,d.useState)(!0),{register:O,handleSubmit:K,watch:Q,formState:{errors:_}}=(0,u.mN)({resolver:(0,m.u)(f)}),F=Q("amount");(0,d.useEffect)(()=>{F&&(y(s,F).then(k),j(s,F).then(E))},[F,s,y,j]),(0,d.useEffect)(()=>{t&&o&&v&&P&&D(BigInt(v.toString())<P)},[t,o,v,P]);let J=async()=>{P&&S((0,l.J)(P,18))},R=async e=>{await b({args:[BigInt(s),BigInt(e.amount)]})},$=async e=>{await N({args:[BigInt(s),BigInt(e.amount)]})};return B?(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:B.name}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Company Details"}),(0,a.jsxs)("p",{children:["Owner: ",B.owner]}),(0,a.jsxs)("p",{children:["Total Supply: ",(0,l.J)(B.totalSupply,0)]}),(0,a.jsxs)("p",{children:["Share Price: ",I?(0,l.J)(I,18):"N/A"," DSTK"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Trade"}),(0,a.jsxs)("form",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount"}),(0,a.jsx)("input",{...O("amount"),type:"number",id:"amount",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),_.amount&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:_.amount.message})]}),P&&(0,a.jsxs)("p",{children:["Estimated Cost: ",(0,l.J)(P,18)," DSTK"]}),A&&(0,a.jsxs)("p",{children:["Estimated Proceeds: ",(0,l.J)(A,18)," DSTK"]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[T?(0,a.jsx)("button",{type:"button",onClick:J,disabled:C,className:"w-full destock-button-secondary",children:C?"Approving...":"Approve DSTK"}):(0,a.jsx)("button",{type:"button",onClick:K(R),className:"w-full destock-button-primary",children:"Buy Shares"}),(0,a.jsx)("button",{type:"button",onClick:K($),className:"w-full destock-button-danger",children:"Sell Shares"})]})]})]})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(h,{companyId:s})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(x,{companyId:s})})]}):(0,a.jsx)("div",{children:"Loading..."})}},15098:(e,s,t)=>{Promise.resolve().then(t.bind(t,7787))},36543:(e,s,t)=>{"use strict";t.d(s,{P:()=>l});var a=t(33055),n=t(54953),r=t(441),i=t(14532),c=t(53995);function l(){let{chainId:e}=(0,a.F)(),s=(0,i.RZ)("DESTOCK",null!=e?e:31337),{data:t,refetch:l}=(0,n.Q)({abi:i.$B,address:s,functionName:"nextCompanyId"}),{writeContractAsync:d,isPending:o,isConfirming:u,isConfirmed:m,error:h}=(0,r.x)(),x=async(e,t,a,n)=>{await d({abi:i.$B,address:s,functionName:"registerCompany",args:[e,BigInt(t),(0,c.g)(a),n]}),l()},{writeContractAsync:f}=(0,r.x)(),{writeContractAsync:g}=(0,r.x)();return{nextCompanyId:Number(t),registerCompany:x,isPending:o,isConfirming:u,isConfirmed:m,error:h,getCompany:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"getCompanyDetails",args:[BigInt(e)]}),getSharePrice:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"getSharePrice",args:[BigInt(e)]}),getBuyPrice:(e,t)=>(0,n.Q)({abi:i.$B,address:s,functionName:"getBuyPrice",args:[BigInt(e),BigInt(t)]}),getSellPrice:(e,t)=>(0,n.Q)({abi:i.$B,address:s,functionName:"getSellPrice",args:[BigInt(e),BigInt(t)]}),buyShares:f,sellShares:g}}},62942:(e,s,t)=>{"use strict";var a=t(42418);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},80660:(e,s,t)=>{"use strict";t.d(s,{W:()=>l});var a=t(33055),n=t(54953),r=t(441),i=t(14532),c=t(53995);function l(){let{address:e,chainId:s}=(0,a.F)(),t=(0,i.RZ)("DSTK_TOKEN",null!=s?s:31337),l=(0,i.RZ)("DESTOCK",null!=s?s:31337),{data:d,refetch:o}=(0,n.Q)({abi:i.MO,address:t,functionName:"balanceOf",args:[e]}),{data:u,refetch:m}=(0,n.Q)({abi:i.MO,address:t,functionName:"allowance",args:[e,l]}),{writeContractAsync:h,isPending:x}=(0,r.x)(),f=async e=>{await h({abi:i.MO,address:t,functionName:"approve",args:[l,(0,c.g)(e)]}),m()},{writeContractAsync:g}=(0,r.x)(),{writeContractAsync:p}=(0,r.x)(),{writeContractAsync:y}=(0,r.x)();return{balance:d,allowance:u,approve:f,isApproving:x,mint:g,transferFromContract:p,batchAirDrop:y,refetchBalance:o,refetchAllowance:m}}}},e=>{var s=s=>e(e.s=s);e.O(0,[55,823,599,532,587,315,358],()=>s(15098)),_N_E=e.O()}]);