(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{7787:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>p});var t=a(54568),n=a(62942),r=a(36543),i=a(80660),c=a(33055),d=a(29548),l=a(7620),o=a(68072),u=a(61938),m=a(90060);function h(e){let{companyId:s}=e,[a,n]=(0,l.useState)([]),[r,i]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{!async function(){try{let e=await fetch("/api/trades/".concat(s)),a=await e.json();n(a)}catch(e){console.error("Failed to fetch trade history:",e)}finally{i(!1)}}()},[s]),r)?(0,t.jsx)("div",{children:"Loading trade history..."}):(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Trade History"}),(0,t.jsx)("ul",{className:"space-y-2",children:a.map((e,s)=>(0,t.jsxs)("li",{className:"p-2 rounded-md ".concat("buy"===e.type?"bg-green-100":"bg-red-100"),children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:e.type.toUpperCase()}),(0,t.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{children:[e.amount," shares"]}),(0,t.jsxs)("span",{children:[(0,d.J)(BigInt(e.price),18)," DSTK"]})]}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]},s))})]})}function x(e){let{companyId:s}=e,[a,n]=(0,l.useState)([]),[r,i]=(0,l.useState)(!0);return((0,l.useEffect)(()=>{!async function(){try{let e=await fetch("/api/shareholders/".concat(s)),a=await e.json();n(a)}catch(e){console.error("Failed to fetch shareholders:",e)}finally{i(!1)}}()},[s]),r)?(0,t.jsx)("div",{children:"Loading shareholders..."}):(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Shareholders"}),(0,t.jsx)("ul",{className:"space-y-2",children:a.map((e,s)=>(0,t.jsx)("li",{className:"p-2 rounded-md bg-gray-100",children:(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:e.address}),(0,t.jsxs)("span",{children:[e.balance," shares"]})]})},s))})]})}var g=a(14532);let f=o.Ik({amount:o.Yj().min(1,"Amount is required")});function p(){let{id:e}=(0,n.useParams)(),s=parseInt(e),{isConnected:a,address:o,chainId:p}=(0,c.F)(),{getCompany:y,getSharePrice:j,getBuyPrice:b,getSellPrice:N,buyShares:S,sellShares:v}=(0,r.P)(),{balance:w,approve:B,allowance:C,isApproving:I}=(0,i.W)(),P=(0,g.RZ)("DESTOCK",null!=p?p:31337),{data:k}=y(s),{data:T}=j(s),[A,D]=(0,l.useState)(!0),{register:E,handleSubmit:O,watch:K,formState:{errors:$}}=(0,u.mN)({resolver:(0,m.u)(f)}),Q=K("amount"),{data:R}=b(s,Q||"0"),{data:_}=N(s,Q||"0");(0,l.useEffect)(()=>{a&&o&&C&&R&&D(BigInt(C.toString())<BigInt(R.toString()))},[a,o,C,R]);let F=async()=>{R&&B((0,d.J)(BigInt(R.toString()),18))},J=async e=>{await S({abi:g.$B,address:P,functionName:"buyShares",args:[BigInt(s),BigInt(e.amount)]})},L=async e=>{await v({abi:g.$B,address:P,functionName:"sellShares",args:[BigInt(s),BigInt(e.amount)]})};return k?(0,t.jsxs)("div",{className:"container mx-auto p-4",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:k.name}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Company Details"}),(0,t.jsxs)("p",{children:["Owner: ",k.owner]}),(0,t.jsxs)("p",{children:["Total Supply: ",(0,d.J)(k.totalSupply,0)]}),(0,t.jsxs)("p",{children:["Share Price: ",T?(0,d.J)(T,18):"N/A"," DSTK"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Trade"}),(0,t.jsxs)("form",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount"}),(0,t.jsx)("input",{...E("amount"),type:"number",id:"amount",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),$.amount&&(0,t.jsx)("p",{className:"text-red-500 text-sm",children:$.amount.message})]}),R&&(0,t.jsxs)("p",{children:["Estimated Cost: ",(0,d.J)(BigInt(R.toString()),18)," DSTK"]}),_&&(0,t.jsxs)("p",{children:["Estimated Proceeds: ",(0,d.J)(BigInt(_.toString()),18)," DSTK"]}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[A?(0,t.jsx)("button",{type:"button",onClick:F,disabled:I,className:"w-full destock-button-secondary",children:I?"Approving...":"Approve DSTK"}):(0,t.jsx)("button",{type:"button",onClick:O(J),className:"w-full destock-button-primary",children:"Buy Shares"}),(0,t.jsx)("button",{type:"button",onClick:O(L),className:"w-full destock-button-danger",children:"Sell Shares"})]})]})]})]}),(0,t.jsx)("div",{className:"mt-8",children:(0,t.jsx)(h,{companyId:s})}),(0,t.jsx)("div",{className:"mt-8",children:(0,t.jsx)(x,{companyId:s})})]}):(0,t.jsx)("div",{children:"Loading..."})}},15098:(e,s,a)=>{Promise.resolve().then(a.bind(a,7787))},36543:(e,s,a)=>{"use strict";a.d(s,{P:()=>d});var t=a(33055),n=a(54953),r=a(441),i=a(14532),c=a(53995);function d(){let{chainId:e}=(0,t.F)(),s=(0,i.RZ)("DESTOCK",null!=e?e:31337),{data:a,refetch:d}=(0,n.Q)({abi:i.$B,address:s,functionName:"nextCompanyId"}),{writeContractAsync:l,isPending:o,isConfirming:u,isConfirmed:m,error:h}=(0,r.x)(),x=async(e,a,t,n)=>{await l({abi:i.$B,address:s,functionName:"registerCompany",args:[e,BigInt(a),(0,c.g)(t),n]}),d()},{writeContractAsync:g}=(0,r.x)(),{writeContractAsync:f}=(0,r.x)();return{nextCompanyId:Number(a),registerCompany:x,isPending:o,isConfirming:u,isConfirmed:m,error:h,getCompany:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"getCompanyDetails",args:[BigInt(e)]}),getSharePrice:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"getSharePrice",args:[BigInt(e)]}),getBuyPrice:(e,a)=>(0,n.Q)({abi:i.$B,address:s,functionName:"getBuyPrice",args:[BigInt(e),BigInt(a)]}),getSellPrice:(e,a)=>(0,n.Q)({abi:i.$B,address:s,functionName:"getSellPrice",args:[BigInt(e),BigInt(a)]}),buyShares:g,sellShares:f}}},62942:(e,s,a)=>{"use strict";var t=a(42418);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(s,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})},80660:(e,s,a)=>{"use strict";a.d(s,{W:()=>d});var t=a(33055),n=a(54953),r=a(441),i=a(14532),c=a(53995);function d(){let{address:e,chainId:s}=(0,t.F)(),a=(0,i.RZ)("DSTK_TOKEN",null!=s?s:31337),d=(0,i.RZ)("DESTOCK",null!=s?s:31337),{data:l,refetch:o}=(0,n.Q)({abi:i.MO,address:a,functionName:"balanceOf",args:[e]}),{data:u,refetch:m}=(0,n.Q)({abi:i.MO,address:a,functionName:"allowance",args:[e,d]}),{writeContractAsync:h,isPending:x}=(0,r.x)(),g=async e=>{await h({abi:i.MO,address:a,functionName:"approve",args:[d,(0,c.g)(e)]}),m()},{writeContractAsync:f}=(0,r.x)(),{writeContractAsync:p}=(0,r.x)(),{writeContractAsync:y}=(0,r.x)();return{balance:l,allowance:u,approve:g,isApproving:x,mint:f,transferFromContract:p,batchAirDrop:y,refetchBalance:o,refetchAllowance:m}}}},e=>{var s=s=>e(e.s=s);e.O(0,[55,823,599,532,587,315,358],()=>s(15098)),_N_E=e.O()}]);