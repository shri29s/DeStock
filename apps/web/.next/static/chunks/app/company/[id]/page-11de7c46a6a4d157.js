(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{7787:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(54568),n=t(62942),r=t(36543),i=t(80660),c=t(33055),l=t(29548),d=t(7620),o=t(68072),u=t(61938),m=t(90060);function h(e){let{companyId:s}=e,[t,n]=(0,d.useState)([]),[r,i]=(0,d.useState)(!0);return((0,d.useEffect)(()=>{!async function(){try{let e=await fetch("/api/trades/".concat(s)),t=await e.json();n(t)}catch(e){console.error("Failed to fetch trade history:",e)}finally{i(!1)}}()},[s]),r)?(0,a.jsx)("div",{children:"Loading trade history..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Trade History"}),(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsxs)("li",{className:"p-2 rounded-md ".concat("buy"===e.type?"bg-green-100":"bg-red-100"),children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.type.toUpperCase()}),(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[e.amount," shares"]}),(0,a.jsxs)("span",{children:[(0,l.J)(BigInt(e.price),18)," DSTK"]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.address})]},s))})]})}function x(e){let{companyId:s}=e,[t,n]=(0,d.useState)([]),[r,i]=(0,d.useState)(!0);return((0,d.useEffect)(()=>{!async function(){try{let e=await fetch("/api/shareholders/".concat(s)),t=await e.json();n(t)}catch(e){console.error("Failed to fetch shareholders:",e)}finally{i(!1)}}()},[s]),r)?(0,a.jsx)("div",{children:"Loading shareholders..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Shareholders"}),(0,a.jsx)("ul",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsx)("li",{className:"p-2 rounded-md bg-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:e.address}),(0,a.jsxs)("span",{children:[e.balance," shares"]})]})},s))})]})}var f=t(14532);let g=o.Ik({amount:o.Yj().min(1,"Amount is required")});function p(){let{id:e}=(0,n.useParams)(),s=parseInt(e),{isConnected:t,address:o,chainId:p}=(0,c.F)(),{getCompany:y,getSharePrice:b,buyShares:j,sellShares:N}=(0,r.P)(),{balance:S,approve:w,allowance:v,isApproving:B}=(0,i.W)(),I=(0,f.RZ)("DESTOCK",null!=p?p:31337),{data:C}=y(s),{data:P}=b(s),A=function(e){if(Array.isArray(e)&&e.length>=5&&"bigint"==typeof e[0]&&"string"==typeof e[1]&&"string"==typeof e[2]&&"bigint"==typeof e[3]&&"bigint"==typeof e[4])return{id:e[0],name:e[1],owner:e[2],initialPrice:e[3],totalSupply:e[4]}}(C),[k,O]=(0,d.useState)(!0),{register:T,handleSubmit:E,watch:D,formState:{errors:K}}=(0,u.mN)({resolver:(0,m.u)(g)}),R=D("amount");P&&R&&(BigInt(P)*BigInt(R)).toString(),(0,d.useEffect)(()=>{t&&o&&v&&P&&R&&O(BigInt(v.toString())<BigInt(P)*BigInt(R))},[t,o,v,P,R]);let $=async()=>{if(P&&R){let e=BigInt(P)*BigInt(R);w((0,l.J)(e,18))}},_=async e=>{await j({abi:f.$B,address:I,functionName:"buyShares",args:[BigInt(s),BigInt(e.amount)]})},F=async e=>{await N({abi:f.$B,address:I,functionName:"sellShares",args:[BigInt(s),BigInt(e.amount)]})};return A?(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:A.name}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Company Details"}),(0,a.jsxs)("p",{children:["Owner: ",A.owner]}),(0,a.jsxs)("p",{children:["Total Supply: ",A.totalSupply.toString()]}),(0,a.jsxs)("p",{children:["Share Price: ",P?(0,l.J)(P,18):"N/A"," DSTK"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Trade"}),(0,a.jsxs)("form",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700",children:"Amount"}),(0,a.jsx)("input",{...T("amount"),type:"number",id:"amount",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),K.amount&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:K.amount.message})]}),P&&R&&(0,a.jsxs)("p",{children:["Estimated Cost:"," ",(0,l.J)(BigInt(P)*BigInt(R),18)," ","DSTK"]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[k?(0,a.jsx)("button",{type:"button",onClick:$,disabled:B,className:"w-full destock-button-secondary",children:B?"Approving...":"Approve DSTK"}):(0,a.jsx)("button",{type:"button",onClick:E(_),className:"w-full destock-button-primary",children:"Buy Shares"}),(0,a.jsx)("button",{type:"button",onClick:E(F),className:"w-full destock-button-danger",children:"Sell Shares"})]})]})]})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(h,{companyId:s})}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(x,{companyId:s})})]}):(0,a.jsx)("div",{children:"Loading..."})}},15098:(e,s,t)=>{Promise.resolve().then(t.bind(t,7787))},36543:(e,s,t)=>{"use strict";t.d(s,{P:()=>l});var a=t(33055),n=t(54953),r=t(441),i=t(14532),c=t(53995);function l(){let{chainId:e}=(0,a.F)(),s=(0,i.RZ)("DESTOCK",null!=e?e:31337),{data:t,refetch:l}=(0,n.Q)({abi:i.$B,address:s,functionName:"nextCompanyId"}),{writeContractAsync:d,isPending:o,error:u}=(0,r.x)(),m=async(e,t,a)=>{await d({abi:i.$B,address:s,functionName:"registerCompany",args:[e,(0,c.g)(a),BigInt(t)]}),l()},{writeContractAsync:h}=(0,r.x)(),{writeContractAsync:x}=(0,r.x)();return{nextCompanyId:Number(t),registerCompany:m,isPending:o,error:u,getCompany:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"companies",args:[BigInt(e)]}),getSharePrice:e=>(0,n.Q)({abi:i.$B,address:s,functionName:"getSharePrice",args:[BigInt(e)]}),getShareBalance:(e,t)=>(0,n.Q)({abi:i.$B,address:s,functionName:"balanceOf",args:[t,BigInt(e)]}),buyShares:h,sellShares:x}}},62942:(e,s,t)=>{"use strict";var a=t(42418);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},80660:(e,s,t)=>{"use strict";t.d(s,{W:()=>l});var a=t(33055),n=t(54953),r=t(441),i=t(14532),c=t(53995);function l(){let{address:e,chainId:s}=(0,a.F)(),t=(0,i.RZ)("DSTK_TOKEN",null!=s?s:31337),l=(0,i.RZ)("DESTOCK",null!=s?s:31337),d=null!=e?e:"0x0000000000000000000000000000000000000000",{data:o,refetch:u}=(0,n.Q)({abi:i.MO,address:t,functionName:"balanceOf",args:[d]}),{data:m,refetch:h}=(0,n.Q)({abi:i.MO,address:t,functionName:"allowance",args:[d,l]}),{writeContractAsync:x,isPending:f}=(0,r.x)(),g=async e=>{await x({abi:i.MO,address:t,functionName:"approve",args:[l,(0,c.g)(e)]}),h()},{writeContractAsync:p}=(0,r.x)(),{writeContractAsync:y}=(0,r.x)(),{writeContractAsync:b}=(0,r.x)();return{balance:o,allowance:m,approve:g,isApproving:f,mint:p,transferFromContract:y,batchAirDrop:b,refetchBalance:u,refetchAllowance:h}}}},e=>{var s=s=>e(e.s=s);e.O(0,[55,823,599,532,587,315,358],()=>s(15098)),_N_E=e.O()}]);